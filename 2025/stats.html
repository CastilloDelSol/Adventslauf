<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Distance Statistics Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* Dark serious theme */
:root {
  --bg: #0D1117;
  --card: #1F242C;
  --text: #E6EDF3;
  --muted: #9BA5B4;
  --border: #30363D;
  --primary: #0EA5E9;
  --radius: 14px;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: Inter, sans-serif;
  padding: 30px;
  display: flex;
  justify-content: center;
}

.page {
  width: 100%;
  max-width: 1100px;
}

h1 {
  margin-bottom: 10px;
  font-size: 26px;
  font-weight: 600;
}

.subtitle {
  color: var(--muted);
  margin-bottom: 25px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(12,1fr);
  gap: 20px;
}

.stat-box {
  background: var(--card);
  padding: 18px 22px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
}

.stat-value {
  font-size: 28px;
  font-weight: 600;
}

.stat-label {
  color: var(--muted);
  font-size: 13px;
}

.card {
  background: var(--card);
  padding: 22px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  margin-top: 30px;
}

.card-title {
  color: var(--primary);
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 14px;
}

canvas { width: 100% !important; height: 380px !important; }
</style>
</head>

<body>
<div class="page">
<h1>Distance Statistics</h1>
<div class="subtitle">Percentile distribution on logarithmic scale</div>

<!-- Summary -->
<div class="grid">

  <div class="stat-box" style="grid-column: span 3;">
    <div class="stat-value" id="total">–</div>
    <div class="stat-label">Teilnehmer</div>
  </div>

  <div class="stat-box" style="grid-column: span 3;">
    <div class="stat-value" id="min">–</div>
    <div class="stat-label">Minimum (km)</div>
  </div>

  <div class="stat-box" style="grid-column: span 3;">
    <div class="stat-value" id="median">–</div>
    <div class="stat-label">Median (km)</div>
  </div>

  <div class="stat-box" style="grid-column: span 3;">
    <div class="stat-value" id="avg">–</div>
    <div class="stat-label">Durchschnitt (km)</div>
  </div>

</div>

<!-- Percentile log chart -->
<div class="card">
  <div class="card-title">km</div>
  <canvas id="percentileChart"></canvas>
</div>

</div>

<script>
// Format numbers with German style
function fmt(n) {
  return n.toLocaleString("de-DE", { minimumFractionDigits: 0, maximumFractionDigits: 2 });
}

document.addEventListener("DOMContentLoaded", () => {
  fetch("./statistics.json")
    .then(r => r.json())
    .then(data => {
      document.getElementById("total").textContent  = fmt(data.total_participants);
      document.getElementById("min").textContent    = fmt(data.distance_min_km);
      document.getElementById("median").textContent = fmt(data.distance_median_km);
      document.getElementById("avg").textContent    = fmt(data.distance_avg_km);

      const percentiles = Object.entries(data.percentiles_km)
        .sort((a,b) => parseFloat(a[0]) - parseFloat(b[0]));

      const x = percentiles.map(([p]) => parseFloat(p));
      const y = percentiles.map(([_,v]) => v);

      new Chart(document.getElementById("percentileChart"), {
        type: "line",
        data: {
          labels: x,
          datasets: [{
            label: "Distanz",
            data: y,
            borderColor: "#0EA5E9",
            borderWidth: 2,
            pointRadius: 3,
            pointBackgroundColor: "#0EA5E9",
            tension: 0
          }]
        },
        options: {
          plugins: { legend: { display: false }},
          scales: {
            x: {
              title: { display: true, text: "Percentil [%]" },
              ticks: { color: "#9BA5B4" }
            },
            y: {
              type: "logarithmic",
              title: { display: true, text: "Distanz [km]" },
              ticks: {
                color: "#9BA5B4",
                callback: v => fmt(v)
              },
              min: 0.1,
              max: 10000
            }
          }
        }
      });
    });
});
</script>

</body>
</html>
