<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Pyramidenchart – Standard Chart.js</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <h2>Kurzstrecke – Pyramidenchart (Standard Chart.js)</h2>
  <canvas id="pyramidChart" width="900" height="600"></canvas>

<script>
async function loadChart() {
  // JSON laden
  const resp = await fetch("./age_buckets_by_distance.json");
  const data = await resp.json();
  const group = data["Kurzstrecke"];

  let labels = [];
  for (const key in group) {
      labels.push(key);
  }

// extract values
const m_vals = labels.map(k => group[k].M);
const w_vals = labels.map(k => group[k].W);

// left side negative
const m_negative = m_vals.map(v => -v);

// symmetric axis range
const maxValue = Math.max(...m_vals, ...w_vals);
const axisMax = Math.ceil(maxValue / 10) * 10;

// plugin to center labels
const centerLabels = {
  id: "centerLabels",
  afterDraw(chart) {
    const { ctx, scales } = chart;
    const yScale = scales.y;
    const xCenter = scales.x.getPixelForValue(0);

    ctx.save();
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "white";

    yScale.ticks.forEach((tick, i) => {
      const y = yScale.getPixelForTick(i);
      ctx.fillText(tick.label, xCenter, y);
    });

    ctx.restore();
  }
};

new Chart(document.getElementById("pyramidChart"), {
  type: "bar",
  data: {
    labels: labels,
    datasets: [
      {
        label: "M",
        data: m_negative,
        backgroundColor: "rgba(0,160,255,0.7)"
      },
      {
        label: "W",
        data: w_vals,
        backgroundColor: "rgba(255,80,120,0.7)"
      }
    ]
  },
  options: {
    indexAxis: "y",
    responsive: true,
    plugins: {
      legend: { position: "top" },
      tooltip: {
        callbacks: {
          label: function(ctx) {
            const value = Math.abs(ctx.raw);
            return ctx.dataset.label + ": " + value;
          }
        }
      }
    },
    scales: {
      x: {
        min: -axisMax,
        max: axisMax,
        ticks: {
          callback: value => Math.abs(value)
        },
        grid: {
          color: "rgba(255,255,255,0.15)"
        }
      },
      y: {
        grid: { display: false }
      }
    }
  },
  plugins: [centerLabels]
});

loadChart();
</script>
</body>
</html>
